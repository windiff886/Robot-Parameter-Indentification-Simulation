# 辨识算法评估原理

本文档详细介绍了在 BIRDy 框架及其 ROS 2 实现中，如何评估机器人动力学参数辨识算法的性能与准确性。评估方法根据工作模式（仿真 vs 实验）而有所不同。

## 1. 仿真模式 (Simulation Mode)

在仿真环境下，我们拥有“上帝视角”，即机器人的**真实动力学参数 (Ground Truth, $\beta_{true}$)** 是完全已知的。这使得我们可以进行最直接、最精确的评估。

### 1.1 参数真值对比

评估的核心是直接比较**辨识参数 ($\beta_{est}$)** 与**真实参数 ($\beta_{true}$)**。

*   **绝对误差 (Absolute Error)**:
    $$ E_{abs, i} = | \beta_{est, i} - \beta_{true, i} | $$
*   **相对误差 (Relative Error)**:
    $$ E_{rel, i} = \frac{| \beta_{est, i} - \beta_{true, i} |}{| \beta_{true, i} |} \times 100\% $$
    *(注意：对于接近 0 的真实参数，相对误差可能无意义)*
*   **整体范数误差 (Norm Error)**:
    $$ E_{norm} = || \beta_{est} - \beta_{true} ||_2 $$

### 1.2 为什么仿真评估很重要？

1.  **验证算法正确性**: 如果在无噪声的理想仿真中，算法无法精确恢复出 $\beta_{true}$（误差应接近机器精度），说明算法实现或观测矩阵构建存在 Bug。
2.  **噪声敏感性分析**: 通过人为添加不同强度的噪声，观察参数误差的变化趋势，可以评估算法的鲁棒性（例如对比 OLS 和 TLS）。

---

## 2. 实验模式 (Experiment Mode)

在真实物理机器人实验中，物理参数的真值通常是**未知**的（CAD 模型提供的参数往往不准确，且无法反映制造误差、电缆质量等）。因此，我们无法直接计算参数误差。

此时，主要依靠**交叉验证 (Cross-Validation)** 方法。

### 2.1 交叉验证流程

1.  **数据集划分**:
    *   **辨识集 (Identification Set)**: 用于训练（计算）参数 $\beta_{est}$ 的数据。通常包含丰富的频率分量（如 Fourier 激励轨迹）。
    *   **验证集 (Validation Set)**: **必须**是独立于辨识集的一组新数据。不能使用辨识集本身来做验证，否则会导致过拟合 (Overfitting) 的假象。

2.  **力矩预测**:
    利用验证集采集到的运动数据 $(q_{val}, \dot{q}_{val}, \ddot{q}_{val})$ 和在辨识集上算出的参数 $\beta_{est}$，预测理论力矩：
    $$ \tau_{pred} = W(q_{val}, \dot{q}_{val}, \ddot{q}_{val}) \cdot \beta_{est} $$

3.  **残差分析**:
    比较预测力矩与验证集实际测量的力矩 $\tau_{meas}$：
    $$ \tau_{res} = \tau_{meas} - \tau_{pred} $$

### 2.2 评估指标

*   **均方根误差 (RMSE, Root Mean Square Error)**:
    这是最常用的指标，反映了模型对未见数据的解释能力。
    $$ RMSE = \sqrt{\frac{1}{N} \sum_{k=1}^{N} || \tau_{meas, k} - \tau_{pred, k} ||^2 } $$
    **RMSE 越小，说明辨识出的模型泛化能力越强，物理一致性越好。**

---

## 3. 激励轨迹质量评估

无论是在仿真还是实验中，辨识结果的好坏很大程度上取决于**激励轨迹**的质量。如果轨迹没有充分激发机器人的动力学特性，参数将是不可观测的。

### 3.1 条件数 (Condition Number)

观测矩阵 $W$ 的条件数是衡量激励充分性的关键指标：
$$ \text{cond}(W) = \frac{\sigma_{max}(W)}{\sigma_{min}(W)} $$

*   **理想情况**: $\text{cond}(W) = 1$（各参数完全正交且同等可观测）。
*   **实际目标**: 尽可能小（通常 < 100 为优）。
*   **意义**: 条件数越小，方程组 $W\beta=\tau$ 对测量噪声 $\delta \tau$ 的敏感度越低，解 $\beta$ 越稳定。

### 3.2 优化目标

在设计实验时，通常通过优化轨迹参数（如 Fourier 系数）来最小化观测矩阵的条件数，从而为算法提供最佳的数据基础。
